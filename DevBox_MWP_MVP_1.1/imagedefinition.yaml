$schema: "1.0"
name: "Win11-24H2-Ent-M365-WSL2-Ubuntu"
image: "microsoftwindowsdesktop_windows-ent-cpc_win11-24h2-ent-cpc-m365"

# ------------------------------------------------------------
# Team tasks: winget + PowerShell scripts
# ------------------------------------------------------------
tasks:

  # ---- Install dev tools via winget ----
  - name: ~/winget
    displayName: "Install Git"
    parameters:
      package: Git.Git
      # Optional: include these if needed
      # options: "--silent --accept-package-agreements"

  - name: ~/winget
    displayName: "Install VS Code"
    parameters:
      package: Microsoft.VisualStudioCode

  - name: ~/winget
    displayName: "Install Docker Desktop"
    parameters:
      package: Docker.DockerDesktop

  - name: ~/winget
    displayName: "Install Windows Terminal"
    parameters:
      package: Microsoft.WindowsTerminal

  - name: ~/winget
    displayName: "Install Slack"
    parameters:
      package: SlackTechnologies.Slack

  # ---- Team PowerShell scripts ----
  - name: ~/powershell
    displayName: "Enable WSL"
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\devbox_mwp_mvp_1.1\win11-24h2-ent-m365-wsl2-ubuntu\scripts\Enable_WSL.ps1

  - name: ~/powershell
    displayName: "Install Ubuntu 22.04"
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\devbox_mwp_mvp_1.1\win11-24h2-ent-m365-wsl2-ubuntu\scripts\Install_Ubuntu2204.ps1

  - name: ~/powershell
    displayName: "Set UAC Policy"
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\devbox_mwp_mvp_1.1\win11-24h2-ent-m365-wsl2-ubuntu\scripts\UAC_Policy_Default.ps1

  - name: ~/powershell
    displayName: "Remove Microsoft Store"
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\devbox_mwp_mvp_1.1\win11-24h2-ent-m365-wsl2-ubuntu\scripts\Remove_MSStore_CurrentUser.ps1

  - name: ~/powershell
    displayName: "Remove Windows Terminal"
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\devbox_mwp_mvp_1.1\win11-24h2-ent-m365-wsl2-ubuntu\scripts\Remove_WindowsTerminal.ps1

# ------------------------------------------------------------
# User tasks (first login)
# ------------------------------------------------------------
userTasks:
  - name: ~/powershell
    displayName: "User Validation"
    parameters:
      script: C:\ProgramData\Microsoft\DevBoxAgent\ImageDefinitions\devbox_mwp_mvp_1.1\win11-24h2-ent-m365-wsl2-ubuntu\scripts\User_Validation.ps1
